var BookingFormCode=(()=>{document.addEventListener("DOMContentLoaded",function(){console.log("Booking Only Form JS loaded");let c=document.getElementById("booking-form-code");if(!c)return;let f=document.getElementById("purchase_code"),m=document.querySelectorAll('input[name="location"]'),r=document.getElementById("booking_date"),i=document.getElementById("time_slot"),u=document.querySelectorAll('input[name="gender"]'),o=c.querySelector(".btn-submit"),p=document.getElementById("booking-response"),b=null;function h(){let e=document.querySelector('input[name="location"]:checked');return e?e.value:""}function v(){let e=document.querySelector('input[name="gender"]:checked');return e?e.value:""}f.addEventListener("input",function(e){let t=e.target.value.toUpperCase();e.target.value=t,t.length===16?S():E()});function S(){m.forEach(e=>{e.disabled=!1}),d("success","Codice valido! Seleziona una location.")}function E(){m.forEach(e=>{e.disabled=!0,e.checked=!1}),k()}function k(){r.value="",r.disabled=!0,i.value="",i.innerHTML='<option value="">-- Seleziona una fascia oraria --</option>',i.disabled=!0,u.forEach(e=>{e.disabled=!0,e.checked=!1}),o.disabled=!0,g()}m.forEach(e=>{e.addEventListener("change",function(){this.checked&&(r.disabled=!1,r.value="",i.value="",i.innerHTML='<option value="">-- Seleziona una fascia oraria --</option>',i.disabled=!0,u.forEach(t=>{t.disabled=!0,t.checked=!1}),o.disabled=!0,g(),b=null)})}),r.addEventListener("change",function(){let e=h();this.value&&e?(i.value="",i.innerHTML='<option value="">-- Seleziona una fascia oraria --</option>',u.forEach(t=>{t.disabled=!0,t.checked=!1}),o.disabled=!0,L(e,this.value)):(i.disabled=!0,u.forEach(t=>t.disabled=!0),o.disabled=!0)}),i.addEventListener("change",function(){if(this.value){u.forEach(s=>{s.disabled=!1});let e=this.options[this.selectedIndex],t=e.dataset.categorie||"",n=e.dataset.disponibilita||"0",a=document.getElementById("selected_categorie");a||(a=document.createElement("input"),a.type="hidden",a.id="selected_categorie",a.name="categorie",c.appendChild(a)),a.value=t;let l=document.getElementById("selected_disponibilita");l||(l=document.createElement("input"),l.type="hidden",l.id="selected_disponibilita",l.name="disponibilita",c.appendChild(l)),l.value=n}else u.forEach(e=>{e.disabled=!0,e.checked=!1}),o.disabled=!0;y()}),u.forEach(e=>{e.addEventListener("change",y)});function y(){let e=f.value.trim().length===16,t=h(),n=r.value,a=i.value,l=v();o.disabled=!(e&&t&&n&&a&&l)}function d(e,t){p.className=`booking-response ${e}`,p.textContent=t,p.style.display="block",p.scrollIntoView({behavior:"smooth",block:"nearest"})}function g(){p.style.display="none"}function L(e,t){d("","Verifica disponibilit\xE0 in corso..."),i.disabled=!0,i.innerHTML='<option value="">-- Seleziona una fascia oraria --</option>';let n=new FormData;n.append("action","check_availability_api"),n.append("nonce",bookingCodeAjax.nonce),n.append("location",e),n.append("booking_date",t),fetch(bookingCodeAjax.ajaxurl,{method:"POST",body:n}).then(a=>a.json()).then(a=>{if(a.success){if(b=a.data,b.available_slots.filter(s=>s.disponibilita>0).length===0){d("error","Nessuna fascia oraria disponibile per questa data."),i.disabled=!0;return}d("success",a.data.message||"Disponibilit\xE0 verificata!"),C(b.available_slots),i.disabled=!1}else d("error",a.data.message||"Nessuna disponibilit\xE0 per questa data."),i.disabled=!0}).catch(a=>{console.error("Errore API:",a),d("error","Errore di connessione durante la verifica disponibilit\xE0."),i.disabled=!0})}function C(e){if(i.innerHTML='<option value="">-- Seleziona una fascia oraria --</option>',!e||e.length===0){d("error","Nessuna fascia oraria disponibile per questa data.");return}e.forEach(t=>{if(t.disponibilita>0){let n=document.createElement("option");n.value=t.id,n.textContent=`${t.time} - ${t.disponibilita} posti disponibili`,n.dataset.time=t.time,n.dataset.categorie=t.categorie||"",n.dataset.disponibilita=t.disponibilita,i.appendChild(n)}})}c.addEventListener("submit",function(e){e.preventDefault();let t=f.value.trim(),n=h(),a=v();if(t.length!==16){d("error","Il codice deve essere di 16 caratteri.");return}if(!n||!r.value||!i.value||!a){d("error","Compila tutti i campi obbligatori.");return}o.disabled=!0,o.textContent="Invio in corso...",g();let l=new FormData(c);fetch(bookingCodeAjax.ajaxurl,{method:"POST",body:l}).then(s=>s.json()).then(s=>{s.success?(d("success",s.data.message),s.data.redirect_url?setTimeout(()=>{window.location.href=s.data.redirect_url},1500):(c.reset(),E())):(d("error",s.data.message||"Errore durante la prenotazione."),o.disabled=!1)}).catch(s=>{console.error("Errore submit:",s),d("error","Errore di connessione."),o.disabled=!1}).finally(()=>{o.textContent="Conferma Prenotazione",o.disabled&&setTimeout(()=>{o.disabled=!1},2e3)})})});})();
//# sourceMappingURL=booking-only-form.min.js.map
